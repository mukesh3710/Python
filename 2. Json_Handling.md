# ‚≠ê MODULE 2 ‚Äî JSON HANDLING IN PYTHON (BEGINNER ‚Üí REAL WORLD)

Python uses the built-in **json** module:

```python
import json
```

JSON = **JavaScript Object Notation**, used for APIs, inventory, config, etc.

---

# ‚úÖ **2.1 Loading JSON (from a string)**

Beginner example:

```python
import json

raw = '{"name": "server1", "cpu": 4}'
data = json.loads(raw)

print(data["name"])
print(data["cpu"])
```

Output:

```
server1
4
```

---

# üõ† **2.1 REAL-WORLD: Load JSON response from ServiceNow**

Imagine ServiceNow returns:

```json
{
  "result": [
    {
      "name": "server1",
      "fadn": "server1.corp",
      "os": "Red Hat Enterprise Linux",
      "u_patching_group": "Wave 1",
      "u_patch_slot": "slot-2"
    }
  ]
}
```

You parse it like:

```python
response = requests.get(url, auth=auth)
snow_data = response.json()

hosts = snow_data["result"]

for h in hosts:
    print(h["name"], h["u_patching_group"])
```

---

# ‚úÖ **2.2 Converting Python Dictionary ‚Üí JSON string**

Beginner example:

```python
data = {"name": "server1", "cpu": 4}
print(json.dumps(data))
```

Output:

```
{"name": "server1", "cpu": 4}
```

---

# üõ† REAL-WORLD: Convert inventory dictionary ‚Üí JSON

Ansible expects this structure:

```json
{
  "all": {
    "hosts": ["server1", "server2"]
  },
  "wave1": {
    "hosts": ["server1"]
  },
  "wave2": {
    "hosts": ["server2"]
  }
}
```

Python code:

```python
inventory = {
    "all": {"hosts": ["server1", "server2"]},
    "wave1": {"hosts": ["server1"]},
    "wave2": {"hosts": ["server2"]}
}

print(json.dumps(inventory, indent=2))
```

`indent=2` makes output pretty ‚Üí useful for debugging.

---

# ‚úÖ **2.3 Writing JSON to STDOUT (Ansible requirement)**

Dynamic inventory *must* print JSON to **STDOUT**:

```python
print(json.dumps(inventory))
```

Debug logs must go to **STDERR**, for example:

```python
print("Debug: Host missing DNS", file=sys.stderr)
```

This separation is VERY important.

---

# ‚≠ê Practical Skill: Create Empty Inventory Skeleton

Every dynamic inventory script should begin with:

```python
inventory = {
    "_meta": {"hostvars": {}},
    "all": {"hosts": []}
}
```

Add groups dynamically:

```python
inventory["wave1"] = {"hosts": []}
inventory["wave2"] = {"hosts": []}
```

Add hosts:

```python
inventory["all"]["hosts"].append("server1")
inventory["wave1"]["hosts"].append("server1")
```

---

# ‚≠ê REAL-WORLD: Building JSON for Patching Groups

You will eventually create something like:

```python
inv = {
    "_meta": {"hostvars": {}},
    "all": {"hosts": []}
}
```

Then dynamically:

```python
def add_host_to_group(inv, hostname, group):
    # create group if not exists
    if group not in inv:
        inv[group] = {"hosts": []}

    # add host to all + group
    inv["all"]["hosts"].append(hostname)
    inv[group]["hosts"].append(hostname)
```

Usage:

```python
add_host_to_group(inv, "server1", "wave1")
add_host_to_group(inv, "server2", "wave2")
```

Final output:

```python
print(json.dumps(inv, indent=2))
```

---

# ‚≠ê Understanding JSON formats from ServiceNow

ServiceNow usually returns:

```json
{
  "result": [
    { ...host1... },
    { ...host2... }
  ]
}
```

Python access:

```python
results = snow_json["result"]

for host in results:
    print(host["name"], host["u_patching_group"])
```

---

# ‚≠ê Module 2 Summary ‚Äî What You Learned

You now know:

‚úî How to load JSON
‚úî How to create JSON
‚úî How to print JSON for Ansible
‚úî How to structure Ansible dynamic inventory JSON
‚úî How to parse ServiceNow API JSON
‚úî How to build groups and append hosts

This is the **core foundation** for inventory automation.

